# ===========================================================================
#  THE DAILY BRIEF — Nginx Configuration (Amazon Linux 2023)
# ===========================================================================
#  Location: /etc/nginx/conf.d/daily-brief.conf
#
#  This is a reference template. The deploy-ec2.sh script writes this
#  automatically with your domain substituted. Use this for manual setup
#  or troubleshooting.
#
#  Replace YOUR_DOMAIN with your actual domain (e.g. intel.example.com)
# ===========================================================================

server {
    listen 80;
    listen [::]:80;
    server_name YOUR_DOMAIN;

    root /var/www/daily-brief;
    index index.html;

    # --- Security headers ---
    add_header X-Frame-Options "SAMEORIGIN" always;
    add_header X-Content-Type-Options "nosniff" always;
    add_header Referrer-Policy "no-referrer-when-downgrade" always;

    # --- Routes ---

    location / {
        try_files $uri $uri/ =404;
    }

    # JSON data — no caching so dashboard always gets fresh data
    location /output/ {
        add_header Cache-Control "no-cache, must-revalidate";
        add_header Access-Control-Allow-Origin "*";
    }

    # Static assets — cache aggressively
    location ~* \.(css|js|png|jpg|ico|svg|woff2?)$ {
        expires 7d;
        add_header Cache-Control "public, immutable";
    }

    # --- Compression ---
    gzip on;
    gzip_vary on;
    gzip_types text/plain text/css application/json application/javascript text/xml;
    gzip_min_length 1000;

    # --- Logging ---
    access_log /var/log/nginx/daily-brief-access.log;
    error_log /var/log/nginx/daily-brief-error.log;
}

# ===========================================================================
#  After running certbot, it will automatically add an HTTPS server block
#  and modify this file to redirect HTTP -> HTTPS. The resulting config
#  will look something like:
#
#  server {
#      listen 443 ssl;
#      server_name YOUR_DOMAIN;
#      ssl_certificate /etc/letsencrypt/live/YOUR_DOMAIN/fullchain.pem;
#      ssl_certificate_key /etc/letsencrypt/live/YOUR_DOMAIN/privkey.pem;
#      include /etc/letsencrypt/options-ssl-nginx.conf;
#      ssl_dhparam /etc/letsencrypt/ssl-dhparams.pem;
#      ... (same location blocks) ...
#  }
#
#  server {
#      listen 80;
#      server_name YOUR_DOMAIN;
#      return 301 https://$host$request_uri;
#  }
# ===========================================================================
